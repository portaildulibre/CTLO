<?xml version="1.0"?>
<!--
Correcteur terminologique - Ã©radication des anglicismes.
Copyright (C) 2006 Linagora SA - Manuel Odesser modesser@linagora.com

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
-->
<project name="terminologie" default="total">
	<description>This ant file is only to package the AnglicismeThesaurus component</description>
	
	<property name="out.path" 	value="bin/ant" 		/>
	<property name="version" 	value="0.2" 			/>
	<property name="src"		value="src"			/>
	
	
	<property name="target"		value="target"			/>
	<property name="classes"	value="${target}/classes"	/>
	<property name="package"	value="${target}/package"	/>	
	<property name="project.lib"	value="/usr/lib/openoffice.org/program/classes/"/>

	<property name="REPO"		value="/home/rpelisse/.m2/repository"	/>
	<property name="rulesets"	value="pmd.xml"	/>
	
	<path id="project.classpath">
		<fileset dir="${project.lib}">
			<include name="*.jar"/>
		</fileset>
	</path>

	<target name="clean">
		<delete dir="${target}" />
	</target>	
	
	<target name="init" depends="clean">
		<mkdir dir="${basedir}/${target}"/>
	</target>

	<target name="compile" depends="init">
		<mkdir dir="${classes}"/>
		<javac srcdir="${src}"
		       destdir="${classes}"
		       debug="true"> <!-- FIXME: should not be debug for release-->
			<classpath refid="project.classpath"/>
		</javac>
	</target>
	
	<target name="jar" depends="compile">

		<jar 	basedir="${classes}" 
		     	includes="**/*" 
			destfile="${target}/${ant.project.name}-${version}.jar">
			<manifest>
				<attribute 	name="RegistrationClassName" 		
						value="org.linagora.clients.minefi.dpma.terminologie.AnglicismeThesaurus" />
			</manifest>
			<fileset dir="data"/>
		</jar>
		
	</target>
	
	<target name="package" depends="jar">
		<!--
		<mkdir 	dir="${package}/META-INF" />
		<copy 	todir="${out.path}/META-INF" 
		      	file="manifest.xml" />
		<mkdir 	dir="${package}/starBasicLib" />
		<copy 	todir="${package}/starBasicLib">
			<fileset dir="starBasicLib">
				<include name="**/*.xlb" />
				<include name="**/*.xba" />
			</fileset>
		</copy>
		
		<mkdir dir="${package}/dialogLib" />
		<copy todir="${package}/dialogLib">
			<fileset dir="dialogLib">
				<include name="**/*.xlb" />
				<include name="**/*.xdl" />
			</fileset>
		</copy> 
		
		<copy todir="${package}">
			<fileset dir=".">
				<include name="**/*.xcu" />
			</fileset>
		</copy>
		
		<copy todir="${package}" file="README" />
		<copy todir="${package}" file="COPYING" />
		
		-->
		<mkdir  dir="${package}"/>
		<zip 	destfile="${target}/${ant.project.name}-${version}.uno.pkg"
		     	basedir="${package}">
			<fileset dir="${basedir}/resources"	includes="META-INF/manifest.xml"		/>
			<fileset dir="${basedir}" 		includes="README"				/>
			<fileset dir="${basedir}" 		includes="COPYING"				/>
			<fileset dir="${basedir}/lib"		includes="dialogLib/"				/>
			<fileset dir="${basedir}/lib"		includes="starBasicLib/"			/>
			<fileset dir="${basedir}"		includes="images/"				/>
			<fileset dir="${basedir}/resources" 	includes="*.xcu"				/>
			<fileset dir="${classes}"								/>
			<fileset dir="${target}"		includes="${ant.project.name}-${version}.jar"	/>
		</zip>
	</target>

	<target name="quality" depends="pmd"  description="Java Code Quality Control"/>
		
	<target name="pmd" depends="init">
		<path id="pmd.classpath">
			<pathelement location="${REPO}/pmd/pmd/4.2.4/pmd-4.2.4.jar" />
			<pathelement location="${REPO}/asm/asm/3.1/asm-3.1.jar" />
			<pathelement location="${REPO}/backport-util-concurrent/backport-util-concurrent/3.1/backport-util-concurrent-3.1.jar"/>
			<pathelement location="${REPO}/jaxen/jaxen/1.1.1/jaxen-1.1.1.jar" />
			<pathelement location="${rulesets}"/>
		</path>
		
		<taskdef 	name="pmd"
				classname="net.sourceforge.pmd.ant.PMDTask">
			<classpath refid="pmd.classpath" />
		</taskdef>
		
		<!-- Mise ne place de PMD -->
		<pmd 	targetjdk="1.5"
			shortFilenames="true"
			rulesetfiles="${rulesets}">
			<formatter 	type="xml"
					toFile="${target}/pmd.xml"
					linePrefix=".line" />
			<formatter 	type="html"
					toFile="${target}/pmd.html"/>
			<fileset 	dir="${src}">
				<include name="**/*.java" />
			</fileset>
		</pmd>
		
		<xslt 	in="${target}/pmd.xml" 
			style="/perso/workspace/pmd-4.2.4/etc/pmd-nicerhtml.xsl" 
			out="${target}/pmd.html" />
		<!-- Looking for cut'n'paste code -->
		<taskdef name="cpd" classname="net.sourceforge.pmd.cpd.CPDTask">
			<classpath refid="pmd.classpath" />
		</taskdef>
		
		<cpd 	minimumTokenCount="250"
			outputFile="${report.cpd}">
			<fileset 	dir="${src}">
				<include name="**/*.java" />
			</fileset>
		</cpd>  
	</target>
	
	<!-- FIXME: To remove ? -->
	<target name="purge">
		<delete failonerror="false" dir="${out.path}" />
	</target>
	
	
	<target name="deployer">
		<exec executable="C:\Program Files\OpenOffice.org 2.0\program\unopkg.exe">
			<arg value="add"/>
			<arg value="-v"/>
			<arg file="${out.path}/${ant.project.name}.uno.pkg"/>
		</exec>
	</target>
	
	<target name="retirer">
		<exec executable="C:\Program Files\OpenOffice.org 2.0\program\unopkg.exe">
			<arg value="remove"/>
			<arg value="-v"/>
			<arg file="${out.path}/${ant.project.name}.uno.pkg"/>
		</exec>
	</target>
	
	<target name="total" depends="retirer,package,deployer"/>

</project>
